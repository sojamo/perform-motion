<!DOCTYPE html>
<html lang="en">

<head>
  <title>Perform Motion</title>
  <script src="./lib/p5.min_1.11.1.js"></script>
  <link rel="stylesheet" type="text/css" href="./style.css">
  <meta charset="utf-8" />
</head>

<body>
  <div class="row" style="height:40vh;">
    <div class="col">
      <div class="toggle-group" id="group-mode">
        <button class="toggle-btn active">Testing</button>
        <button class="toggle-btn">Sensors</button>
        <button class="toggle-btn" id="mode-automated">Automated</button>
      </div>

      <div class="region" id="testing-lights">
        <h2 class="subtitle">Testing Lights</h2>
        <div class="toggle-group" id="group-test">
          <button class="toggle-btn active">All Lights off</button>
          <button class="toggle-btn">All Lights on</button>
        </div>
        <div class="toggle-group" id="group-test-individual">
          <button class="toggle-btn active">0</button>
          <button class="toggle-btn">1</button>
          <button class="toggle-btn">2</button>
          <button class="toggle-btn">3</button>
          <button class="toggle-btn">4</button>
          <button class="toggle-btn">5</button>
          <button class="toggle-btn">6</button>
          <button class="toggle-btn">7</button>
        </div>
      </div>


      <div class="region" id="automated-controls">
        <h2 class="subtitle">Automated Controls</h2>
        <div class="toggle-group" id="group-automated-controls">
          <button class="toggle-btn">Play</button>
          <button class="toggle-btn">Pause</button>
        </div>
        <button class="btn" id="rewind">Rewind</button>
      </div>
      <div class="region" id="automated-speed">
        <h2 class="subtitle">Speed Control</h2>
        <button class="btn" id="slower">slower</button>
        <button class="btn" id="faster">faster</button>
        <button class="btn" id="normal">normal</button>
      </div>

    </div>
    <div class="col data-report" id="data-report"></div>
  </div>

  <div class="row">
    <div class="col" id="p5-container">
    </div>
  </div>

  <script src="./src/class.analyse.js"></script>
  <script src="./src/class.render.js"></script>
  <script src="./src/class.comms.js"></script>
  <script src="./src/class.witmotion.js"></script>
  <script src="./src/class.kalman.js"></script>
  <script src="./src/class.uibridge.js"></script>
  <script src="./src/class.automated.js"></script>
  <script src="./src/sketch.js"></script>

  <script>

    class ToggleGroup {
      constructor(containerId, onChange) {
        this.container = document.getElementById(containerId);
        this.buttons = Array.from(this.container.querySelectorAll('.toggle-btn'));
        this.onChange = onChange || function () { };

        this.buttons.forEach((btn, idx) => {
          btn.addEventListener('click', () => this.select(idx));
        });
      }

      select(index) {
        this.buttons.forEach(b => b.classList.remove('active'));
        this.buttons[index].classList.add('active');
        this.onChange(index, this.buttons[index]);
      }

      // Optionally, get currently selected index
      getSelectedIndex() {
        return this.buttons.findIndex(btn => btn.classList.contains('active'));
      }
    }

    function setActiveToggle(groupId, btnIndex) {
      const group = document.getElementById(groupId);
      if (!group) return;
      const buttons = group.querySelectorAll('.toggle-btn');
      buttons.forEach((btn, i) => {
        btn.classList.toggle('active', i === btnIndex);
      });
    }

    function deactivateAllToggles(groupId) {
      const group = document.getElementById(groupId);
      if (!group) return;
      group.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
    }

    function buttonClickFor(btnId, onChange) {
      const btn = document.getElementById(btnId);
      if (!btn) return;
      btn.addEventListener('click', function () {
        window.triggerP5Action(onChange);
      });
    }

    new ToggleGroup('group-mode', (index, btn) => {
      window.triggerP5Action({ ref: "mode", value: index });
    });

    new ToggleGroup('group-test', (index, btn) => {
      deactivateAllToggles("group-test-individual");
      setActiveToggle("group-mode", 0);
      window.triggerP5Action({ ref: "mode", value: 0 });
      window.triggerP5Action({ ref: "lights", value: index });
    });

    new ToggleGroup('group-test-individual', (index, btn) => {
      setActiveToggle("group-mode", 0);
      window.triggerP5Action({ ref: "mode", value: 0 });
      window.triggerP5Action({ ref: "individual-light", value: index });
    });

    new ToggleGroup('group-automated-controls', (index, btn) => {
      setActiveToggle("group-mode", 2);
      window.triggerP5Action({ ref: "mode", value: 2 });
      window.triggerP5Action({ ref: "automated-controls", value: index });
    });

    buttonClickFor("rewind", { ref: "automated-controls", value: 2 });
    buttonClickFor("slower", { ref: "automated-speed", value: 0 });
    buttonClickFor("normal", { ref: "automated-speed", value: 1 });
    buttonClickFor("faster", { ref: "automated-speed", value: 2 });
    

  </script>
</body>

</html>